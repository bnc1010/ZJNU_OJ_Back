<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{fragment/header :: header}"></th:block>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/editor/css/editormd.css">
    <script src="/editor/lib/marked.min.js"></script>
    <script src="/editor/lib/raphael.min.js"></script>
    <script src="/editor/lib/underscore.min.js"></script>
    <script src="/editor/lib/sequence-diagram.min.js"></script>
    <script src="/editor/lib/flowchart.min.js"></script>
    <script src="/editor/lib/jquery.flowchart.min.js"></script>
    <script src="/editor/editormd.js"></script>
    <script src="/js/clipboard.min.js"></script>
    <link rel="stylesheet" href="/js/prettify/skins/sunburst.css">
    <title></title>
    <script>
        Vue.component('submit-button',
            {
                data() {
                    return {isdisabled: false}
                },
                template: `<a class="ui inverted primary button" v-bind:class="{disabled:isdisabled,loading:isdisabled}" v-on:click="click_btn">提交</a>`,
                methods: {
                    click_btn: function () {
                        this.isdisabled = true;
                        var that = this
                        setTimeout(function () {
                            that.isdisabled = false;
                        }, 2000);
                        prom.submit();
                    }
                }
            });
    </script>
</head>
<body>
<main class="ui container">
    <div class="ui grid two column row">
        <div class="ui four wide column">
            <div class="ui padded blue segment">
                标签
            </div>
            <div class="ui  green segment" id="vue-history">
                <table class="ui selectable single line compact small striped center aligned table">
                    <thead>
                    <tr>
                        <th>提交结果</th>
                        <th>提交时间</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="s in status">
                        <td class="view-code" v-bind:id="s.id" v-bind:class="{
                            positive:s.result=='Accepted',
                            warning:s.result=='Pending',
                            error:s.result!='Accepted'&&s.result!='Pending'
                            }">{{s.normalResult}}
                        </td>
                        <td class="">{{s.normalSubmitTime}}</td>
                    </tr>
                    </tbody>
                </table>
                <a v-bind:href="'/status?pid='+problem_id">More</a>
            </div>
        </div>
        <div class="ui container twelve wide column" id="vue-problem">
            <div class="ui raised piled segments fluid" style="opacity: 0.8;background-color: white; padding: 1rem">
                <div class="ui secondary center aligned segment" v-bind:class="{loading:!dataready}">
                    <h1>{{problem.title}}</h1>
                    <table class="ui celled center aligned table">
                        <tr>
                            <td><i class="fa fa-clock-o"></i>时间限制</td>
                            <td>{{problem.timeLimit}}</td>
                            <td><i class="fa fa-database"></i>空间限制</td>
                            <td>{{problem.memoryLimit}}B</td>
                            <td>来源</td>
                            <td>{{problem.source}}</td>
                        </tr>
                    </table>
                </div>
                <div class="ui padded segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">题目描述</h2>
                    <div class=" md-text">
                        <textarea style="display: none">{{problem.description}}</textarea>
                    </div>
                </div>
                <div class="ui segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">输入</h2>
                    <div class=" md-text">
                        <textarea style="display: none;">{{problem.input}}</textarea>
                    </div>
                </div>
                <div class="ui segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">输出</h2>
                    <div class=" md-text">
                        <textarea style="display: none;">{{problem.output}}</textarea>
                    </div>
                </div>
                <div class="ui segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">样例输入
                        <button class="ui small button btn-copy"
                                data-clipboard-target="#input-content" data-clipboard-action="copy">Copy
                        </button>
                    </h2>

                    <pre class="" id="input-content">{{problem.sampleInput}}</pre>
                </div>
                <div class="ui segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">样例输出
                        <button class="ui button small btn-copy"
                                data-clipboard-target="#output-content" data-clipboard-action="copy">Copy
                        </button>
                    </h2>
                    <pre class="" id="output-content">{{problem.sampleOutput}}</pre>
                </div>
                <div class="ui tertiary segment" v-bind:class="{loading:!dataready}">
                    <h2 class="">提示</h2>
                    <div class="md-text">
                        <textarea style="display: none;">{{problem.hint}}</textarea>
                    </div>
                </div>
            </div>
            <div class="ui container fluid" style="opacity: 0.8;background-color: white;padding: 1rem">
                <form id="form" class="ui form">
                    <div>
                        <label for="language">语言 :</label>
                        <select class="ui search dropdown" id="language" name="language" v-model="language">
                            <option value="c">C</option>
                            <option selected value="cpp">C++</option>
                            <option value="java">Java</option>
                            <option value="py2">Python2</option>
                            <option value="py3">Python3</option>
                        </select>
                        <div class="ui checked  checkbox">
                            <label for="share">分享代码</label>
                            <input id="share" name="share" v-model="share" type="checkbox">
                        </div>
                    </div>
                    <textarea class="field" cols="40" id="" name="source" rows="20" placeholder="your code..."
                              style="resize: none;" v-model="code"></textarea>
                    <submit-button></submit-button>
                </form>
            </div>
        </div>
    </div>

</main>
<div class="ui large modal" id="codemodal">
    <div class="">
        <div class="" style="padding: 1rem;">
            <div class="ui header">
                <h4 class="">#<span id="modal-id"></span>&nbsp;用户名：<abbr id="modal-username"></abbr>&nbsp;题目：<abbr
                        id="modal-problem"></abbr></h4>
            </div>
            <div class="scrolling content">
                <table class="ui celled table">
                    <thead class="center aligned">
                    <tr>
                        <th><i class="fa fa-check-circle"></i>结果</th>
                        <th><i class="fa fa-clock-o"></i>用时(ms)</th>
                        <th><i class="fa fa-database"></i>内存(Byte)</th>
                        <th><i class="fa fa-files-o"></i>代码长度</th>
                        <th><i class="fa fa-keyboard-o"></i>语言</th>
                        <th><i class="fa fa-calendar"></i>提交时间</th>
                    </tr>
                    </thead>
                    <tbody class="text center aligned">
                    <td id="modal-result">{{normalResult}}</td>
                    <td id="modal-time">{{time}}</td>
                    <td id="modal-memory">{{memory}}</td>
                    <td id="modal-length">{{length}}</td>
                    <td id="modal-language">{{normalLanguage}}</td>
                    <td id="modal-submit-time">{{normalSubmitTime}}</td>
                    </tbody>
                </table>
                <button class="ui button red" id="modal-share">
                    Not Shared
                </button>
                <pre id="modal-ce"></pre>
                <pre class="prettyprint" id="source_code"></pre>
            </div>
            <div class="actions">
                <button class="ui black deny button"><i class="close icon"></i>Close</button>
            </div>
        </div>
    </div>
</div>
<script language="JavaScript" src="/js/StatusInModal.js"></script>
<script>
    $('.ui.checkbox').checkbox();
    pid = location.pathname.split('/');
    pid = pid[pid.length - 1];
    var clipboard = new ClipboardJS('.btn-copy');
    clipboard.on('success', function (e) {
        e.clearSelection();
    });
    clipboard.on('error', function (e) {
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
    });
    vue_history = new Vue({
        el: "#vue-history",
        data: {
            status: [],
            problem_id: pid
        },
        created: function () {
            var that = this;
            axios.get('/api/status/user/latest/submit/' + pid).then(function (res) {
                that.status = res.data;
            })
        }
    });
    // var vm = new Vue({
    //     el: '#top-list',
    //     data: {
    //         status: []
    //     }
    // });
    // $("#leader-board").click(function () {
    //     $.get({
    //         url: "/oj/problems/status/top/" + $("main").attr("id"),
    //         success: function (res) {
    //             vm._data.status = res;
    //         }
    //     });
    // });
    var prom = new Vue({
        el: '#vue-problem',
        data: {
            problem: {},
            code: "",
            language: "c",
            share: true,
            dataready: false
        },
        methods: {
            submit: function () {
                var that = this
                axios.post('/api/problems/submit/' + pid, {
                    language: that.language,
                    source: that.code,
                    share: that.share
                }).then(function (res) {
                    console.log(res.data)
                    if (res.data != "success") {
                        alert(res.data);
                    } else {
                        // scrollTo(0, 0);//x,y
                    }
                })
            }
        },
        created() {
            var that = this;
            axios.get('/api/problems/' + pid).then(function (response) {
                that.problem = response.data;
                $("title").text(response.data.title);
                $(function () {
                    $(".md-text").each(function () {
                        $(this).attr("id", "editormd-view");
                        editormd.markdownToHTML("editormd-view", {
                            gfm: true,
                            toc: true,
                            tocm: false,
                            tocStartLevel: 1,
                            tocTitle: "目录",
                            tocDropdown: false,
                            tocContainer: "",
                            markdown: "",
                            autoLoadKaTeX: true,
                            pageBreak: true,
                            atLink: true,    // for @link
                            emailLink: false,    // for mail address auto link
                            tex: true,
                            taskList: false,   // Github Flavored Markdown task lists
                            flowChart: true,
                            sequenceDiagram: true,
                            previewCodeHighlight: true
                        });
                        $(this).attr("id", "");
                    });
                });
                that.dataready = true;
            }).catch(function (e) {
                console.log(e);
                location.href = "/4O4";
            })
        }
    });
</script>
<footer th:replace="~{fragment/footer :: footer}"></footer>
<!--<script src="/js/StatusInModal.js"></script>-->
</body>
</html>